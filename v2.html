<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>事業ボードゲーム - 実践チュートリアル</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; }
        .game-title { font-family: 'Orbitron', sans-serif; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes pulseRing { 0% { transform: scale(0.95); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.7; } 100% { transform: scale(0.95); opacity: 1; } }
        .animate-bounce { animation: bounce 2s infinite; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        .pulse-slow { animation: pulse 2s infinite; }
        .pulse-ring { animation: pulseRing 2s infinite; }
        .tutorial-overlay { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(2px); z-index: 100; }
        .tutorial-highlight { box-shadow: 0 0 0 4px rgba(168, 85, 247, 0.8), 0 0 30px rgba(168, 85, 247, 0.6); animation: pulseRing 2s infinite; position: relative; z-index: 101; }
        .rank-badge { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Orbitron', sans-serif; font-weight: 900; font-size: 1.25rem; flex-shrink: 0; }
        .rank-1 { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
        .dice { width: 60px; height: 60px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .tutorial-popup { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); max-width: 800px; width: 90%; z-index: 102; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-[#1a1a2e] text-slate-100">
    <div class="min-h-screen p-4 md:p-6 lg:p-8">
        <div class="max-w-6xl mx-auto">
            
            <!-- チュートリアルコンテンツエリア -->
            <div id="tutorial-container"></div>

            <!-- チュートリアルオーバーレイ（説明用ポップアップ） -->
            <div id="tutorial-overlay" class="fixed inset-0 tutorial-overlay hidden">
                <div id="tutorial-message" class="tutorial-popup bg-slate-800 p-6 rounded-2xl border-2 border-purple-500 shadow-2xl text-center"></div>
            </div>

            <!-- モーダル群 -->
            <div id="employee-modal" class="fixed inset-0 hidden items-center justify-center p-4 z-50 bg-black/80 backdrop-blur-sm">
                <div class="bg-slate-800 w-full max-w-md p-6 rounded-2xl border border-slate-700 shadow-2xl">
                    <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                        <span>👥</span><span>人材管理</span>
                    </h2>
                    <div class="mb-4">
                        <h3 class="font-semibold mb-3">雇用</h3>
                        <div class="space-y-2">
                            <button onclick="hireEmployee('junior')" id="hire-junior-btn" class="w-full text-left flex justify-between items-center p-3 bg-slate-700 rounded-lg hover:bg-slate-600 transition-all">
                                <div>
                                    <div class="font-semibold">👨‍💼 ジュニア社員</div>
                                    <div class="text-xs text-slate-400">企画力:1 営業力:1</div>
                                </div>
                                <span class="text-red-400 font-bold">-100万/月</span>
                            </button>
                            <button onclick="hireEmployee('senior')" id="hire-senior-btn" class="w-full text-left flex justify-between items-center p-3 bg-slate-700 rounded-lg hover:bg-slate-600 transition-all">
                                <div>
                                    <div class="font-semibold">👔 シニア社員</div>
                                    <div class="text-xs text-slate-400">企画力:2 営業力:1 技術力:1</div>
                                </div>
                                <span class="text-red-400 font-bold">-200万/月</span>
                            </button>
                            <button onclick="hireEmployee('expert')" id="hire-expert-btn" class="w-full text-left flex justify-between items-center p-3 bg-slate-700 rounded-lg hover:bg-slate-600 transition-all">
                                <div>
                                    <div class="font-semibold">🎓 エキスパート</div>
                                    <div class="text-xs text-slate-400">企画力:2 営業力:2 技術力:1 法務力:1</div>
                                </div>
                                <span class="text-red-400 font-bold">-300万/月</span>
                            </button>
                        </div>
                    </div>
                    <div class="mb-6">
                        <h3 class="font-semibold mb-3">現在の社員 <span class="text-purple-400">(<span id="employee-count">0</span>人)</span></h3>
                        <div id="employee-list" class="space-y-2 max-h-48 overflow-y-auto">
                            <p class="text-slate-400 text-sm">まだ社員はいません</p>
                        </div>
                    </div>
                    <button onclick="closeEmployeeModal()" id="close-employee-btn" class="w-full py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-all">閉じる</button>
                </div>
            </div>

            <div id="business-modal" class="fixed inset-0 hidden items-center justify-center p-4 z-50 bg-black/80 backdrop-blur-sm">
                <div class="bg-slate-800 w-full max-w-md p-6 rounded-2xl border border-slate-700 shadow-2xl max-h-[90vh] overflow-y-auto">
                    <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                        <span>🏢</span><span>事業管理</span>
                    </h2>
                    <form id="business-form" class="mb-6 p-4 bg-slate-900 rounded-lg">
                        <h3 class="font-semibold mb-4">新規事業を追加</h3>
                        <div class="mb-3">
                            <label class="block mb-2 text-sm text-slate-300">事業名</label>
                            <input type="text" id="business-name-input" class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white" placeholder="例: AIチャットボット" required>
                        </div>
                        <div class="mb-3">
                            <label class="block mb-2 text-sm text-slate-300">事業規模</label>
                            <select id="business-size-input" class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white">
                                <option value="S">S (小規模)</option>
                                <option value="M" selected>M (中規模)</option>
                                <option value="L">L (大規模)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="block mb-2 text-sm text-slate-300">月間利益 (万円)</label>
                            <input type="number" id="business-profit-input" class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white" placeholder="例: 2000" required>
                            <p class="text-xs text-slate-400 mt-1">※ 1年分（12ヶ月）が事業価値になります</p>
                        </div>
                        <div class="mb-4">
                            <label class="block mb-2 text-sm text-slate-300">事業構築費用 (万円)</label>
                            <input type="number" id="business-cost-input" class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 text-white" placeholder="例: 1000" required>
                            <p class="text-xs text-slate-400 mt-1">※ 支払う費用（自動で現金から引かれます）</p>
                        </div>
                        <button type="submit" class="w-full py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-all">🚀 事業を追加</button>
                    </form>
                    <div class="mb-6">
                        <h3 class="font-semibold mb-3">現在の事業</h3>
                        <div id="business-list" class="space-y-3">
                            <p class="text-slate-400 text-sm">まだ事業はありません</p>
                        </div>
                    </div>
                    <button onclick="closeBusinessModal()" id="close-business-btn" class="w-full py-3 bg-slate-700 text-white font-semibold rounded-lg hover:bg-slate-600 transition-all">閉じる</button>
                </div>
            </div>

        </div>
    </div>

    <script>
        let currentStep = 0;
        let playerCash = 5000;
        let employees = [];
        let businesses = [];
        let currentTurn = 1;
        let totalTurns = 24;

        const tutorialSteps = [
            // 概要説明ステップ（1-5枚目）
            {
                type: 'intro',
                slides: [
                    {
                        title: "🎮 事業ボードゲームへようこそ！",
                        content: `
                            <div class="space-y-8">
                                <div class="text-center">
                                    <div class="text-6xl mb-4">🚀</div>
                                    <p class="text-2xl font-bold text-slate-200 leading-relaxed mb-4">
                                        新規事業を立ち上げ、成長させて<br>
                                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-400 font-black text-3xl">No.1</span> を目指すゲームです
                                    </p>
                                </div>

                                <div class="bg-gradient-to-r from-purple-900/50 to-purple-800/30 p-8 rounded-2xl border-2 border-purple-500 shadow-2xl">
                                    <h3 class="text-2xl font-bold text-purple-300 mb-6 text-center">👔 あなたの役割</h3>
                                    <div class="space-y-4 text-slate-200 text-lg">
                                        <p class="leading-relaxed">
                                            あなたは<span class="text-purple-300 font-bold">大企業の「新規事業担当者」</span>です。
                                        </p>
                                        <p class="leading-relaxed">
                                            他の部署が頑張って稼いだお金を<br>
                                            <span class="text-green-400 font-bold text-xl">毎月500万円</span>いただきながら、<br>
                                            新しい事業創出に挑戦しています。
                                        </p>
                                    </div>
                                </div>

                                <div class="bg-gradient-to-r from-blue-900/50 to-blue-800/30 p-8 rounded-2xl border-2 border-blue-500 shadow-2xl">
                                    <h3 class="text-2xl font-bold text-blue-300 mb-6 text-center">🎯 ゲームの目的</h3>
                                    <div class="space-y-4 text-slate-200 text-lg">
                                        <p class="leading-relaxed">
                                            限られた<span class="text-yellow-400 font-bold">「資金」</span>と<span class="text-yellow-400 font-bold">「時間（2年間）」</span>の中で、
                                        </p>
                                        <ul class="space-y-2 ml-6">
                                            <li class="flex items-center gap-2">
                                                <span class="text-green-400 text-xl">✓</span>
                                                <span>人材を採用し</span>
                                            </li>
                                            <li class="flex items-center gap-2">
                                                <span class="text-green-400 text-xl">✓</span>
                                                <span>アイデアを育て</span>
                                            </li>
                                            <li class="flex items-center gap-2">
                                                <span class="text-green-400 text-xl">✓</span>
                                                <span>事業を構築すること</span>
                                            </li>
                                        </ul>
                                        <p class="leading-relaxed pt-4 border-t border-blue-700">
                                            新規事業が辿るプロセスでの<br>
                                            <span class="text-blue-300 font-bold">「人材」「アイデア」「資金」</span>の動きを<br>
                                            シミュレートするゲームです！
                                        </p>
                                    </div>
                                </div>

                                <div class="bg-gradient-to-r from-slate-800 to-slate-700 p-8 rounded-2xl border-2 border-slate-600 shadow-2xl">
                                    <h3 class="text-2xl font-bold text-slate-200 mb-4 text-center">🏆 勝利条件</h3>
                                    <p class="text-xl font-bold text-green-400 text-center mb-3">現金 + 事業価値 = 最高得点</p>
                                    <p class="text-base text-slate-300 text-center">※ 事業価値 = 1年間で上げる利益（月間利益 × 12ヶ月）</p>
                                </div>

                                <div class="p-6 bg-blue-900/30 border-2 border-blue-500 rounded-xl">
                                    <p class="text-blue-200 text-center text-lg">
                                        💡 このゲームは<span class="font-bold">ボードゲーム</span>と<span class="font-bold">アプリ</span>を<br>
                                        組み合わせて遊びます
                                    </p>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "📊 新規事業の3つのフェーズ",
                        content: `
                            <p class="text-slate-200 text-center mb-8 text-lg">新規事業にはこんなフェーズがあります</p>
                            <p class="text-slate-300 text-center mb-8">アイデアに必要な人材を配置して、判定に成功するとフェーズが進みます</p>
                            <div class="space-y-4">
                                <div class="bg-gradient-to-r from-purple-900/50 to-purple-800/30 p-6 rounded-xl border-2 border-purple-500">
                                    <div class="flex items-center gap-4 mb-3">
                                        <div class="bg-purple-600 text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl">1</div>
                                        <h3 class="text-2xl font-bold text-purple-300">仮説立案</h3>
                                    </div>
                                    <p class="text-slate-200 ml-16 mb-2 text-base">💡 アイデアを考え、顧客課題を特定する段階</p>
                                    <div class="ml-16 p-3 bg-slate-900/50 rounded-lg">
                                        <p class="text-sm font-bold text-purple-200 mb-1">必要能力:</p>
                                        <p class="text-base text-slate-200">企画力 | 営業力</p>
                                    </div>
                                </div>

                                <div class="bg-gradient-to-r from-blue-900/50 to-blue-800/30 p-6 rounded-xl border-2 border-blue-500">
                                    <div class="flex items-center gap-4 mb-3">
                                        <div class="bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl">2</div>
                                        <h3 class="text-2xl font-bold text-blue-300">仮説検証</h3>
                                    </div>
                                    <p class="text-slate-200 ml-16 mb-2 text-base">🔬 小さく試して、顧客の反応を確かめる段階</p>
                                    <div class="ml-16 p-3 bg-slate-900/50 rounded-lg">
                                        <p class="text-sm font-bold text-blue-200 mb-1">必要能力:</p>
                                        <p class="text-base text-slate-200">企画力 | 営業力 | 技術力</p>
                                    </div>
                                </div>

                                <div class="bg-gradient-to-r from-green-900/50 to-green-800/30 p-6 rounded-xl border-2 border-green-500">
                                    <div class="flex items-center gap-4 mb-3">
                                        <div class="bg-green-600 text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl">3</div>
                                        <h3 class="text-2xl font-bold text-green-300">ビジネス構築</h3>
                                    </div>
                                    <p class="text-slate-200 ml-16 mb-2 text-base">🏗️ 事業を本格的に立ち上げる段階</p>
                                    <div class="ml-16 p-3 bg-slate-900/50 rounded-lg mb-2">
                                        <p class="text-sm font-bold text-green-200 mb-1">必要能力:</p>
                                        <p class="text-base text-slate-200">企画力 | 営業力 | 技術力 | 法務力</p>
                                    </div>
                                    <div class="ml-16 p-4 bg-green-900/30 border-2 border-green-500 rounded-lg">
                                        <p class="text-base font-bold text-green-200">💰 成功すると...</p>
                                        <p class="text-sm text-slate-200 mt-1">毎月の利益が入ってくるようになります！</p>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "📈 事業規模（S・M・L）",
                        content: `
                            <p class="text-slate-200 text-center mb-6 text-lg">事業規模によって利益・判定難易度・必要能力が変わります</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <div class="bg-slate-800 p-6 rounded-xl border-2 border-slate-500">
                                    <div class="text-center mb-4">
                                        <div class="text-5xl mb-2">🏪</div>
                                        <h4 class="text-2xl font-bold text-slate-300">S (小規模)</h4>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="p-4 bg-slate-900/50 rounded-lg">
                                            <p class="text-sm text-slate-400 mb-1">月間利益</p>
                                            <p class="text-2xl font-bold text-green-400">200〜400万</p>
                                        </div>
                                        <div class="p-4 bg-green-900/30 border border-green-600 rounded-lg">
                                            <p class="text-sm text-green-300 font-bold mb-1">判定</p>
                                            <p class="text-sm text-slate-200">通りやすい</p>
                                            <p class="text-xs text-slate-400">(10面ダイスで3以上など)</p>
                                        </div>
                                        <div class="p-4 bg-blue-900/30 border border-blue-600 rounded-lg">
                                            <p class="text-sm text-blue-300 font-bold mb-1">必要能力</p>
                                            <p class="text-sm text-slate-200">低い</p>
                                            <p class="text-xs text-slate-400">(営業力1など)</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-800 p-6 rounded-xl border-2 border-blue-500">
                                    <div class="text-center mb-4">
                                        <div class="text-5xl mb-2">🏢</div>
                                        <h4 class="text-2xl font-bold text-blue-300">M (中規模)</h4>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="p-4 bg-slate-900/50 rounded-lg">
                                            <p class="text-sm text-slate-400 mb-1">月間利益</p>
                                            <p class="text-2xl font-bold text-green-400">1,000〜3,000万</p>
                                        </div>
                                        <div class="p-4 bg-yellow-900/30 border border-yellow-600 rounded-lg">
                                            <p class="text-sm text-yellow-300 font-bold mb-1">判定</p>
                                            <p class="text-sm text-slate-200">中程度の難易度</p>
                                        </div>
                                        <div class="p-4 bg-blue-900/30 border border-blue-600 rounded-lg">
                                            <p class="text-sm text-blue-300 font-bold mb-1">必要能力</p>
                                            <p class="text-sm text-slate-200">中程度</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-800 p-6 rounded-xl border-2 border-green-500">
                                    <div class="text-center mb-4">
                                        <div class="text-5xl mb-2">🏭</div>
                                        <h4 class="text-2xl font-bold text-green-300">L (大規模)</h4>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="p-4 bg-slate-900/50 rounded-lg">
                                            <p class="text-sm text-slate-400 mb-1">月間利益</p>
                                            <p class="text-2xl font-bold text-green-400">7,000万〜3億</p>
                                        </div>
                                        <div class="p-4 bg-red-900/30 border border-red-600 rounded-lg">
                                            <p class="text-sm text-red-300 font-bold mb-1">判定</p>
                                            <p class="text-sm text-slate-200">難しい</p>
                                        </div>
                                        <div class="p-4 bg-blue-900/30 border border-blue-600 rounded-lg">
                                            <p class="text-sm text-blue-300 font-bold mb-1">必要能力</p>
                                            <p class="text-sm text-slate-200">高い</p>
                                            <p class="text-xs text-slate-400">(営業力6など)</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="p-8 bg-yellow-900/30 border-2 border-yellow-500 rounded-xl">
                                <p class="text-2xl font-bold text-yellow-200 mb-4 text-center">⚠️ 重要なルール</p>
                                <div class="space-y-3 text-base text-slate-200">
                                    <p>• <span class="font-bold text-yellow-300">M規模</span>を仮説立案するには、<span class="font-bold">S規模</span>をビジネス構築する必要があります</p>
                                    <p>• <span class="font-bold text-yellow-300">L規模</span>を仮説立案するには、<span class="font-bold">M規模</span>をビジネス構築する必要があります</p>
                                    <p class="mt-4 pt-4 border-t-2 border-yellow-600 font-bold text-yellow-200 text-lg">
                                        → 必ず一つ前の段階のビジネスを構築してから次の規模に挑戦できます
                                    </p>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "👥 人材の能力値",
                        content: `
                            <p class="text-slate-200 text-center mb-6 text-lg">人材は<span class="text-yellow-400 font-bold">能力値</span>で評価されます</p>
                            
                            <div class="bg-purple-900/30 border-2 border-purple-500 rounded-xl p-6 mb-8">
                                <h3 class="text-xl font-bold text-purple-300 mb-4 text-center">🎴 面接時と雇用時で能力が変わる！</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto">
                                    <div class="text-center">
                                        <div class="mb-3">
                                            <div class="inline-block p-4 bg-slate-800 rounded-xl border-2 border-blue-500">
                                                <div class="w-32 h-60 bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg flex items-center justify-center">
                                                    <div class="text-center">
                                                        <div class="text-4xl mb-2">👔</div>
                                                        <p class="text-sm text-white font-bold">基本能力</p>
                                                        <p class="text-xs text-blue-200 mt-2">企画: ?<br>営業: ?</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="font-bold text-blue-300 text-lg">面接時（表）</p>
                                        <p class="text-sm text-slate-300 mt-2">基本能力しか<br>わからない</p>
                                    </div>
                                    <div class="text-center">
                                        <div class="mb-3">
                                            <div class="inline-block p-4 bg-slate-800 rounded-xl border-2 border-purple-500">
                                                <div class="w-32 h-60 bg-gradient-to-br from-purple-600 to-purple-700 rounded-lg flex items-center justify-center">
                                                    <div class="text-center">
                                                        <div class="text-4xl mb-2">✨</div>
                                                        <p class="text-sm text-white font-bold">真の能力</p>
                                                        <p class="text-xs text-purple-200 mt-2">企画: 2<br>営業: 2<br>技術: 1<br><span class="text-yellow-300">特殊: ??</span></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="font-bold text-purple-300 text-lg">雇用時（裏）</p>
                                        <p class="text-sm text-slate-300 mt-2">真の能力を把握<br>特殊能力も？？</p>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div class="bg-slate-800 p-6 rounded-xl border-2 border-blue-500">
                                    <div class="text-4xl text-center mb-3">👨‍💼</div>
                                    <h4 class="text-xl font-bold text-center mb-3 text-blue-300">ジュニア社員</h4>
                                    <div class="space-y-2">
                                        <p class="text-slate-200 text-base">💰 人件費: <span class="text-red-400 font-bold">100万/月</span></p>
                                        <div class="p-3 bg-slate-900/50 rounded-lg">
                                            <p class="font-bold text-blue-200 mb-1">能力値の例:</p>
                                            <p class="text-slate-200">企画力: 1</p>
                                            <p class="text-slate-200">営業力: 1</p>
                                            <p class="text-slate-500">技術力: 0</p>
                                            <p class="text-slate-500">法務力: 0</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-800 p-6 rounded-xl border-2 border-purple-500">
                                    <div class="text-4xl text-center mb-3">👔</div>
                                    <h4 class="text-xl font-bold text-center mb-3 text-purple-300">シニア社員</h4>
                                    <div class="space-y-2">
                                        <p class="text-slate-200 text-base">💰 人件費: <span class="text-red-400 font-bold">200万/月</span></p>
                                        <div class="p-3 bg-slate-900/50 rounded-lg">
                                            <p class="font-bold text-purple-200 mb-1">能力値の例:</p>
                                            <p class="text-slate-200">企画力: 2</p>
                                            <p class="text-slate-200">営業力: 1</p>
                                            <p class="text-slate-200">技術力: 1</p>
                                            <p class="text-slate-500">法務力: 0</p>
                                            <p class="text-xs text-slate-400 mt-2">※ 合計3-4</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-800 p-6 rounded-xl border-2 border-yellow-500">
                                    <div class="text-4xl text-center mb-3">🎓</div>
                                    <h4 class="text-xl font-bold text-center mb-3 text-yellow-300">エキスパート</h4>
                                    <div class="space-y-2">
                                        <p class="text-slate-200 text-base">💰 人件費: <span class="text-red-400 font-bold">300万/月</span></p>
                                        <div class="p-3 bg-slate-900/50 rounded-lg">
                                            <p class="font-bold text-yellow-200 mb-1">能力値の例:</p>
                                            <p class="text-slate-200">企画力: 2</p>
                                            <p class="text-slate-200">営業力: 2</p>
                                            <p class="text-slate-200">技術力: 1</p>
                                            <p class="text-slate-200">法務力: 1</p>
                                            <p class="text-xs text-slate-400 mt-2">※ 合計5-6</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "🔄 1ターンの流れ",
                        content: `
                            <p class="text-slate-200 text-center mb-8 text-xl">プレイヤーは以下の<span class="text-yellow-400 font-bold">2つから1つ</span>を選んで実行します</p>
                            
                            <div class="space-y-4 max-w-3xl mx-auto mb-8">
                                <div class="bg-gradient-to-r from-blue-900/50 to-blue-800/30 p-6 rounded-xl border-l-4 border-blue-500">
                                    <h4 class="text-xl font-bold text-blue-300 mb-3 flex items-center gap-2">
                                        <span>👥</span><span>人材を雇う</span>
                                    </h4>
                                    <div class="space-y-2 text-base text-slate-200 ml-8">
                                        <p>🎲 <span class="font-bold">ボードゲーム:</span> 人材カードを市場から<span class="text-yellow-400 font-bold">2枚まで</span>雇用</p>
                                        <p>📱 <span class="font-bold">アプリ:</span> 「人材管理」で記録</p>
                                    </div>
                                </div>

                                <div class="text-center text-3xl text-slate-500 font-bold">または</div>

                                <div class="bg-gradient-to-r from-purple-900/50 to-purple-800/30 p-6 rounded-xl border-l-4 border-purple-500">
                                    <h4 class="text-xl font-bold text-purple-300 mb-3 flex items-center gap-2">
                                        <span>📊</span><span>フェーズを進ませる</span>
                                    </h4>
                                    <div class="space-y-3 text-base text-slate-200 ml-8">
                                        <div>
                                            <p class="font-bold text-purple-200">① 人材を配置</p>
                                            <p class="ml-4 text-sm text-slate-300">アイデアカードに人材カードを配置</p>
                                        </div>
                                        <div>
                                            <p class="font-bold text-purple-200">② ダイスで判定</p>
                                            <p class="ml-4 text-sm text-slate-300">フェーズに判定がある場合のみ</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 max-w-3xl mx-auto mb-6">
                                <h4 class="text-xl font-bold text-slate-200 mb-4">📋 結果の処理</h4>
                                <div class="space-y-3">
                                    <div class="flex items-start gap-3 p-4 bg-green-900/30 border border-green-500 rounded-lg">
                                        <span class="text-2xl">✅</span>
                                        <div>
                                            <p class="font-bold text-green-300 text-base">成功</p>
                                            <p class="text-slate-200">事業のフェーズをプレイヤーボード上で進ませる</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3 p-4 bg-red-900/30 border border-red-500 rounded-lg">
                                        <span class="text-2xl">❌</span>
                                        <div>
                                            <p class="font-bold text-red-300 text-base">失敗</p>
                                            <p class="text-slate-200">現在のフェーズに留まる</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3 p-4 bg-purple-900/30 border border-purple-500 rounded-lg">
                                        <span class="text-2xl">🎉</span>
                                        <div>
                                            <p class="font-bold text-purple-300 text-base">ビジネス構築成功時</p>
                                            <p class="text-slate-200">📱 アプリで事業登録（事業構築費用も入力）</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-slate-800 to-slate-700 p-6 rounded-xl border-l-4 border-green-500 max-w-3xl mx-auto">
                                <h4 class="text-xl font-bold text-green-300 mb-2">⏭️ ターン終了</h4>
                                <p class="text-slate-200 text-base">📱 <span class="font-bold">アプリ:</span> 「ターン終了」ボタンで自動計算</p>
                                <p class="text-slate-300 ml-6 mt-1">※ 月次収入・事業利益・人件費が自動処理されます</p>
                            </div>
                        `
                    }
                ]
            },

            // 人材雇用チュートリアル開始
            { type: 'tutorial-start', section: 'hiring', message: 'まずは人材を雇ってみましょう！' },
            
            // 人材雇用フロー
            { 
                type: 'guide', 
                message: '👥 人材雇用\n\n人材市場から人材を雇用します。\n\n🎲 市場から人材カードを選んでください。\n選んだら「人材管理」ボタンを押してください。', 
                highlight: 'employee-btn' 
            },
            { type: 'action-open-employee' },
            { 
                type: 'guide', 
                message: '人材カードの人件費を確認して、それに合ったレベルを選んでください\n\n100万円 → ジュニア社員\n200万円 → シニア社員\n300万円 → エキスパート', 
                highlight: null 
            },
            { type: 'action-hire' },
            { 
                type: 'guide', 
                message: '✅ 人材がアプリに記録されました！\n\n🎲 実際のボードゲームでは、人材カードを手札に加えます', 
                highlight: null 
            },

            // フェーズ進行の詳細説明（複数スライド）
            { type: 'tutorial-start', section: 'phase', message: '次はフェーズを進ませる流れを見ていきましょう！' },
            { 
                type: 'guide', 
                message: 'これから5つのステップで\nフェーズ進行の流れを説明します。\n\n準備ができたらOKを押してください。', 
                highlight: null 
            },
            {
                type: 'phase-explanation',
                slides: [
                    {
                        title: "📊 フェーズを進ませるとは？",
                        content: `
                            <div class="max-w-4xl mx-auto space-y-8">
                                <div class="bg-gradient-to-r from-purple-900/50 to-purple-800/30 p-8 rounded-2xl border-2 border-purple-500">
                                    <h3 class="text-2xl font-bold text-purple-300 mb-6 text-center">🎲 実際のプレイでは...</h3>
                                    <div class="space-y-6 text-slate-200 text-lg">
                                        <div class="bg-slate-900/50 p-6 rounded-xl">
                                            <p class="font-bold text-purple-200 mb-3">1️⃣ 自分のターンになったら</p>
                                            <p class="leading-relaxed">「人材を雇う」か「フェーズを進ませる」を選びます。</p>
                                            <p class="leading-relaxed mt-2">フェーズを進ませることを選んだら、アイデアカードを1つ選びます。</p>
                                        </div>
                                        
                                        <div class="bg-slate-900/50 p-6 rounded-xl">
                                            <p class="font-bold text-purple-200 mb-3">2️⃣ アイデアカードの必要能力を確認</p>
                                            <p class="leading-relaxed">選んだアイデアカードには、各フェーズで必要な能力値が書かれています。</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "🎴 アイデアカードの見方",
                        content: `
                            <div class="max-w-4xl mx-auto space-y-8">
                                <div class="bg-gradient-to-r from-blue-900/50 to-blue-800/30 p-8 rounded-2xl border-2 border-blue-500">
                                    <h3 class="text-2xl font-bold text-blue-300 mb-6 text-center">📋 必要能力値の確認</h3>
                                    
                                    <div class="bg-slate-900/50 p-6 rounded-xl border-2 border-slate-700 mb-6">
                                        <p class="text-center text-slate-400 mb-4">📸 アイデアカードの例</p>
                                        <img src="/home/claude/idea-card-requirements.png" alt="アイデアカードの必要能力値" class="w-full max-w-2xl mx-auto rounded-lg border-2 border-blue-500" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                        <div style="display:none;" class="bg-slate-800 p-8 rounded-lg text-center">
                                            <p class="text-slate-400 mb-4">🎴 アイデアカード</p>
                                            <div class="grid grid-cols-3 gap-4 text-sm">
                                                <div class="bg-purple-900/50 p-4 rounded">
                                                    <p class="font-bold text-purple-300 mb-2">仮説立案</p>
                                                    <p class="text-slate-300">企画: 2</p>
                                                    <p class="text-slate-300">営業: 1</p>
                                                </div>
                                                <div class="bg-blue-900/50 p-4 rounded">
                                                    <p class="font-bold text-blue-300 mb-2">仮説検証</p>
                                                    <p class="text-slate-300">企画: 2</p>
                                                    <p class="text-slate-300">営業: 2</p>
                                                    <p class="text-slate-300">技術: 1</p>
                                                </div>
                                                <div class="bg-green-900/50 p-4 rounded">
                                                    <p class="font-bold text-green-300 mb-2">構築</p>
                                                    <p class="text-slate-300">全能力</p>
                                                    <p class="text-slate-300">合計: 8</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="text-slate-200 text-lg leading-relaxed">
                                        <p>カードには各フェーズで<span class="text-yellow-400 font-bold">どの能力がいくつ必要か</span>が書かれています。</p>
                                        <p class="mt-4">この必要能力を満たす人材を配置する必要があります。</p>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "👥 人材を配置する",
                        content: `
                            <div class="max-w-4xl mx-auto space-y-8">
                                <div class="bg-gradient-to-r from-green-900/50 to-green-800/30 p-8 rounded-2xl border-2 border-green-500">
                                    <h3 class="text-2xl font-bold text-green-300 mb-6 text-center">🎲 実際のプレイでは...</h3>
                                    
                                    <div class="space-y-6 text-slate-200 text-lg">
                                        <div class="bg-slate-900/50 p-6 rounded-xl">
                                            <p class="font-bold text-green-200 mb-3">手札から人材カードを選ぶ</p>
                                            <p class="leading-relaxed">必要な能力を持つ人材カードを手札から選び、アイデアカードに配置します。</p>
                                        </div>

                                        <div class="bg-slate-900/50 p-6 rounded-xl border-2 border-slate-700">
                                            <p class="text-center text-slate-400 mb-4">📸 人材配置のイメージ</p>
                                            <img src="/home/claude/personnel-placement.png" alt="人材配置" class="w-full max-w-2xl mx-auto rounded-lg border-2 border-green-500" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                            <div style="display:none;" class="bg-slate-800 p-8 rounded-lg">
                                                <div class="flex justify-center items-center gap-4 flex-wrap">
                                                    <div class="bg-blue-700 p-6 rounded-xl border-2 border-blue-300">
                                                        <p class="text-white font-bold text-center mb-2">👔</p>
                                                        <p class="text-white text-sm">シニア</p>
                                                        <p class="text-blue-200 text-xs mt-2">企画:2 営業:1</p>
                                                    </div>
                                                    <div class="text-4xl">→</div>
                                                    <div class="bg-purple-800 p-6 rounded-xl border-2 border-purple-300">
                                                        <p class="text-white font-bold mb-2">🎴 アイデア</p>
                                                        <p class="text-purple-200 text-xs">仮説立案中</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="bg-slate-900/50 p-6 rounded-xl">
                                            <p class="font-bold text-green-200 mb-3">複数人を配置することもできる</p>
                                            <p class="leading-relaxed">必要な能力に達するまで、複数の人材を配置できます。</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "🎲 ダイス判定を行う",
                        content: `
                            <div class="max-w-4xl mx-auto space-y-8">
                                <div class="bg-gradient-to-r from-yellow-900/50 to-orange-900/30 p-8 rounded-2xl border-2 border-yellow-500">
                                    <h3 class="text-2xl font-bold text-yellow-300 mb-6 text-center">🎲 実際のプレイでは...</h3>
                                    
                                    <div class="space-y-6 text-slate-200 text-lg">
                                        <div class="bg-slate-900/50 p-6 rounded-xl">
                                            <p class="font-bold text-yellow-200 mb-3">人材を配置したら、ダイスを振る</p>
                                            <div class="flex justify-center my-4">
                                                <div class="dice">⚄</div>
                                            </div>
                                            <p class="leading-relaxed text-center">10面ダイスを振って、成功判定を行います。</p>
                                            <p class="text-slate-400 text-base text-center mt-2">※ 配置した人材の能力値の合計と出目で判定</p>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div class="bg-green-900/30 border-2 border-green-500 p-6 rounded-xl">
                                                <p class="font-bold text-green-300 text-center mb-3 text-xl">✅ 成功</p>
                                                <p class="text-slate-200 text-center">アイデアカードを次のフェーズエリアに進める</p>
                                            </div>
                                            <div class="bg-red-900/30 border-2 border-red-500 p-6 rounded-xl">
                                                <p class="font-bold text-red-300 text-center mb-3 text-xl">❌ 失敗</p>
                                                <p class="text-slate-200 text-center">アイデアカードは現在のフェーズに留まる</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "🎉 ビジネス構築まで成功したら",
                        content: `
                            <div class="max-w-4xl mx-auto space-y-8">
                                <div class="bg-gradient-to-r from-purple-900/50 to-pink-900/30 p-8 rounded-2xl border-2 border-purple-500">
                                    <h3 class="text-2xl font-bold text-purple-300 mb-6 text-center">🎉 ビジネス構築に成功！</h3>
                                    
                                    <div class="space-y-6 text-slate-200 text-lg">
                                        <div class="bg-slate-900/50 p-6 rounded-xl">
                                            <p class="font-bold text-purple-200 mb-3">🎲 ボードゲーム側</p>
                                            <p class="leading-relaxed">アイデアカードを「完成」エリアに移動させます。</p>
                                            <p class="leading-relaxed mt-2">このアイデアは事業として収益を生み出すようになります！</p>
                                        </div>

                                        <div class="bg-slate-900/50 p-6 rounded-xl border-2 border-purple-500">
                                            <p class="font-bold text-purple-200 mb-4">📱 アプリ側</p>
                                            <p class="leading-relaxed mb-4">アプリで事業を登録します。</p>
                                            <div class="bg-slate-800 p-4 rounded-lg">
                                                <p class="font-bold text-yellow-200 mb-3">登録する内容:</p>
                                                <ul class="space-y-2 ml-4 text-base">
                                                    <li>• 事業名（アイデアカードに書かれた名前）</li>
                                                    <li>• 事業規模（S / M / L）</li>
                                                    <li>• 月間利益（アイデアカードに書かれた金額）</li>
                                                    <li>• <span class="text-yellow-400 font-bold">事業構築費用（支払う費用）</span></li>
                                                </ul>
                                            </div>
                                        </div>

                                        <div class="text-center p-6 bg-green-900/30 border-2 border-green-500 rounded-xl">
                                            <p class="text-2xl font-bold text-green-300">💰 次のターンから</p>
                                            <p class="text-lg mt-2">登録した月間利益が毎月入ってくるようになります！</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    }
                ]
            },
            
            // 事業登録チュートリアル開始
            { type: 'tutorial-start', section: 'business', message: '実際にアプリで事業を登録してみましょう！' },
            { 
                type: 'guide', 
                message: 'これからアプリで事業登録を\n実際に体験します。\n\n準備ができたらOKを押してください。', 
                highlight: null 
            },
            // 事業登録チュートリアル
            { 
                type: 'guide', 
                message: '🎲 ボードゲームで...\n\n人材を配置 → ダイス判定 → 成功！\n\n✅ ビジネス構築に成功しました！\n\n📱 アプリで事業を登録しましょう', 
                highlight: null 
            },
            { 
                type: 'guide', 
                message: '🏢 事業管理ボタンをクリックしてください', 
                highlight: 'business-btn' 
            },
            { type: 'action-open-business' },
            { 
                type: 'guide', 
                message: '事業情報を入力してください\n\n例:\n事業名: AIチャットボット\n規模: M\n月間利益: 2000万円\n事業構築費用: 1000万円', 
                highlight: null 
            },
            { type: 'action-add-business' },
            
            // ターン終了
            { 
                type: 'guide', 
                message: '✅ 事業が登録されました！\n\n📱 ターンを終了して収支を確認しましょう', 
                highlight: null 
            },
            { 
                type: 'guide', 
                message: '➡️ ターン終了ボタンをクリックしてください', 
                highlight: 'end-turn-btn' 
            },
            { type: 'action-end-turn' },
            
            { type: 'complete', message: 'チュートリアル完了！' }
        ];

        let currentSlideIndex = 0;

        function renderTutorial() {
            const step = tutorialSteps[currentStep];

            if (step.type === 'intro' || step.type === 'phase-explanation') {
                renderSlides(step);
            } else if (step.type === 'tutorial-start') {
                renderTutorialStart(step);
            } else if (step.type === 'guide') {
                renderGameScreen();
                showGuidePopup(step);
            } else if (step.type.startsWith('action-')) {
                hideGuidePopup();
                renderGameScreen();
            } else if (step.type === 'complete') {
                showCompletionScreen();
            }
        }

        function renderSlides(step) {
            const slide = step.slides[currentSlideIndex];
            const container = document.getElementById('tutorial-container');

            container.innerHTML = `
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-slate-400">進捗</span>
                        <span class="text-sm font-bold text-slate-300">${currentSlideIndex + 1} / ${step.slides.length}</span>
                    </div>
                    <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300" style="width: ${((currentSlideIndex + 1) / step.slides.length) * 100}%"></div>
                    </div>
                </div>

                <div class="bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 p-6 md:p-10 shadow-2xl" style="padding-bottom: 120px;">
                    <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">${slide.title}</h2>
                    <div class="fade-in overflow-y-auto max-h-[60vh]">${slide.content}</div>
                </div>

                <div class="mt-8 flex justify-between items-center">
                    <button ${currentSlideIndex === 0 ? 'disabled class="opacity-30 cursor-not-allowed"' : ''} onclick="prevSlide()" class="px-6 py-3 bg-slate-700 text-white font-semibold rounded-lg hover:bg-slate-600 transition-all">← 前へ</button>
                    <div class="flex gap-2">
                        ${step.slides.map((_, i) => `<div class="w-2 h-2 rounded-full transition-all ${i === currentSlideIndex ? 'bg-purple-500 w-8' : 'bg-slate-600'}"></div>`).join('')}
                    </div>
                    <button onclick="${currentSlideIndex === step.slides.length - 1 ? 'nextStep()' : 'nextSlide()'}" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold rounded-lg hover:shadow-lg transition-all">
                        ${currentSlideIndex === step.slides.length - 1 ? (step.type === 'intro' ? '人材を雇う →' : '事業登録へ →') : '次へ →'}
                    </button>
                </div>
            `;
        }

        function renderTutorialStart(step) {
            const container = document.getElementById('tutorial-container');
            
            const configs = {
                hiring: {
                    emoji: '👥',
                    title: 'まずは人材を雇ってみましょう！',
                    description: '人材を雇うとは、このゲームで何を意味するのでしょうか？',
                    content: `
                        <div class="bg-slate-800 p-8 rounded-xl border border-slate-700 max-w-3xl mx-auto">
                            <h3 class="text-xl font-bold mb-6 text-center">🎲 実際のプレイでは...</h3>
                            <div class="space-y-6 text-slate-200 text-lg">
                                <div class="bg-slate-900/50 p-6 rounded-xl">
                                    <p class="font-bold text-blue-300 mb-3">1. 自分のターンになったら</p>
                                    <p class="leading-relaxed">「人材を雇う」を選択します。</p>
                                </div>
                                
                                <div class="bg-slate-900/50 p-6 rounded-xl">
                                    <p class="font-bold text-blue-300 mb-3">2. 人材市場から選ぶ</p>
                                    <p class="leading-relaxed">市場に並んでいる人材カードから、欲しい人材を<span class="text-yellow-400 font-bold">最大2枚まで</span>選びます。</p>
                                </div>

                                <div class="bg-slate-900/50 p-6 rounded-xl">
                                    <p class="font-bold text-blue-300 mb-3">3. 人材カードを裏返す</p>
                                    <p class="leading-relaxed">選んだ人材カードを<span class="text-purple-400 font-bold">裏返して</span>、真の能力値を確認します。</p>
                                    <p class="text-slate-400 text-base mt-2">※ 表面には基本能力しか書かれていません</p>
                                </div>

                                <div class="bg-slate-900/50 p-6 rounded-xl border-2 border-purple-500">
                                    <p class="font-bold text-purple-300 mb-3">4. アプリで記録</p>
                                    <p class="leading-relaxed">📱 アプリの「人材管理」で、裏面に書かれた能力値を登録します。</p>
                                    <p class="text-slate-400 text-base mt-2">人件費に応じたレベル（ジュニア/シニア/エキスパート）を選択</p>
                                </div>

                                <div class="bg-slate-900/50 p-6 rounded-xl">
                                    <p class="font-bold text-blue-300 mb-3">5. 手札に加える</p>
                                    <p class="leading-relaxed">雇用した人材カードを手札に加えます。</p>
                                    <p class="text-slate-400 text-base mt-2">次のターンから、この人材をアイデアに配置できます！</p>
                                </div>
                            </div>
                        </div>
                    `,
                    buttonText: '実際にやってみる 👨‍💼',
                    buttonColor: 'from-blue-600 to-blue-700'
                },
                phase: {
                    emoji: '📊',
                    title: '次はフェーズを進ませる流れを見ていきましょう！',
                    description: 'フェーズを進ませるとは、どういうことでしょうか？',
                    content: `
                        <div class="bg-slate-800 p-8 rounded-xl border border-slate-700 max-w-3xl mx-auto">
                            <h3 class="text-xl font-bold mb-6 text-center">🎲 実際のプレイでは...</h3>
                            <div class="space-y-6 text-slate-200 text-lg">
                                <p class="leading-relaxed text-center">アイデアカードを選び、人材を配置して、<br>ダイス判定でフェーズを進めていきます。</p>
                                <p class="leading-relaxed text-center text-slate-400">詳しい流れを順番に見ていきましょう！</p>
                            </div>
                        </div>
                    `,
                    buttonText: '流れを見る 📊',
                    buttonColor: 'from-purple-600 to-purple-700'
                },
                business: {
                    emoji: '🏢',
                    title: '実際にアプリで事業を登録してみましょう！',
                    description: 'ビジネス構築に成功したときの操作です',
                    content: `
                        <div class="bg-slate-800 p-8 rounded-xl border border-slate-700 max-w-3xl mx-auto">
                            <h3 class="text-xl font-bold mb-6 text-center">🎉 ビジネス構築成功！</h3>
                            <div class="space-y-6 text-slate-200 text-lg">
                                <p class="leading-relaxed text-center">アイデアが事業として完成しました！</p>
                                <p class="leading-relaxed text-center">📱 アプリで事業情報を登録して、<br>毎月の収益を受け取れるようにしましょう。</p>
                            </div>
                        </div>
                    `,
                    buttonText: '事業を登録する 🏢',
                    buttonColor: 'from-green-600 to-green-700'
                }
            };

            const config = configs[step.section];

            container.innerHTML = `
                <div class="text-center space-y-8">
                    <div class="text-8xl mb-6 animate-bounce">${config.emoji}</div>
                    <h2 class="text-4xl font-bold">${config.title}</h2>
                    <p class="text-xl text-slate-300">${config.description}</p>
                    ${config.content}
                    <button onclick="nextStep()" class="px-12 py-4 bg-gradient-to-r ${config.buttonColor} text-white text-xl font-bold rounded-xl shadow-2xl hover:shadow-lg transform hover:scale-105 transition-all pulse-slow">
                        ${config.buttonText}
                    </button>
                </div>
            `;
        }

        function renderGameScreen() {
            const container = document.getElementById('tutorial-container');
            const year = Math.floor((currentTurn - 1) / 12) + 1;
            const month = ((currentTurn - 1) % 12) + 1;

            container.innerHTML = `
                <header class="mb-8">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                        <div>
                            <h1 class="game-title text-3xl md:text-4xl mb-2 bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent font-black">
                                事業ボードゲーム
                            </h1>
                            <div class="flex flex-wrap items-center gap-3">
                                <div class="text-sm text-slate-400">
                                    ${year}年目 ${month}月 (${currentTurn}/${totalTurns})
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-800 rounded-xl p-4 flex items-center justify-between border border-slate-700">
                        <div class="flex items-center gap-3">
                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="font-semibold">現在のプレイヤー:</span>
                            <span class="text-lg font-bold text-purple-400">あなた</span>
                        </div>
                        <div class="px-4 py-2 bg-gradient-to-r from-purple-600 to-purple-700 rounded-full font-semibold flex items-center gap-2">
                            <span>👉</span><span>あなたの番です</span>
                        </div>
                    </div>
                </header>

                <section class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><span>🏆</span><span>ランキング</span></h2>
                    <div class="space-y-4">
                        <div class="bg-slate-800 rounded-xl p-4 border border-purple-500 shadow-lg shadow-purple-500/30">
                            <div class="flex items-start gap-4">
                                <div class="rank-badge rank-1">1</div>
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-2">
                                        <h3 class="text-xl font-bold">あなた</h3>
                                        <span class="px-2 py-1 bg-green-900/50 border border-green-500 text-green-400 text-xs font-semibold rounded-full">YOU</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 mt-3">
                                        <div>
                                            <div class="text-xs text-slate-400 mb-1">現金</div>
                                            <div class="text-xl font-bold text-green-400">+${playerCash.toLocaleString()}万</div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-slate-400 mb-1">事業価値</div>
                                            <div class="text-lg font-bold text-green-400">+${calculateBusinessValue()}万</div>
                                        </div>
                                    </div>
                                    <div class="mt-3 pt-3 border-t border-slate-700">
                                        <div class="flex justify-between items-center">
                                            <div class="text-xs text-slate-400">総合スコア</div>
                                            <div class="text-xl font-black bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">
                                                ${(playerCash + calculateBusinessValue()).toLocaleString()}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3 flex flex-wrap gap-2 text-sm">
                                        <span class="text-slate-400">👥 ${employees.length}人</span>
                                        <span class="text-slate-400">🏢 ${businesses.length}事業</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-32">
                    <button id="employee-btn" onclick="handleEmployeeBtn()" class="py-3 bg-slate-700 text-white font-semibold rounded-lg hover:bg-slate-600 transition-all">
                        👥 人材管理
                    </button>
                    <button id="business-btn" onclick="handleBusinessBtn()" class="py-3 bg-slate-700 text-white font-semibold rounded-lg hover:bg-slate-600 transition-all">
                        🏢 事業管理
                    </button>
                    <button id="end-turn-btn" onclick="handleEndTurnBtn()" class="col-span-2 md:col-span-1 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white font-bold rounded-lg shadow-xl hover:shadow-green-500/50 transition-all text-lg">
                        ➡️ ターン終了
                    </button>
                </section>
            `;

            const step = tutorialSteps[currentStep];
            if (step && step.highlight) {
                setTimeout(() => {
                    const el = document.getElementById(step.highlight);
                    if (el) el.classList.add('tutorial-highlight');
                }, 100);
            }
        }

        function showGuidePopup(step) {
            const overlay = document.getElementById('tutorial-overlay');
            const message = document.getElementById('tutorial-message');

            message.innerHTML = `
                <div class="text-4xl mb-3">${step.highlight ? '👇' : '📱'}</div>
                <h3 class="text-xl font-bold mb-3 whitespace-pre-line">${step.message}</h3>
                <button onclick="hideGuidePopupAndNext()" class="mt-4 px-8 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white text-lg font-bold rounded-xl shadow-2xl hover:shadow-purple-500/50 transform hover:scale-105 transition-all">
                    OK 👍
                </button>
            `;

            overlay.classList.remove('hidden');
        }
        function hideGuidePopupAndNext() {
            hideGuidePopup();
            nextStep();
        }

        function hideGuidePopup() {
            const overlay = document.getElementById('tutorial-overlay');
            overlay.classList.add('hidden');
        }

        function showCompletionScreen() {
            const container = document.getElementById('tutorial-container');
            container.innerHTML = `
                <div class="text-center space-y-8">
                    <div class="text-8xl mb-6 animate-bounce">🎉</div>
                    <h2 class="text-4xl font-bold">チュートリアル完了！</h2>
                    <p class="text-xl text-slate-300">お疲れさまでした！</p>
                    <div class="bg-slate-800 p-8 rounded-xl border border-slate-700 max-w-3xl mx-auto">
                        <h3 class="text-2xl font-bold mb-6">📋 学んだこと</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                            <div class="bg-slate-900/50 p-4 rounded-lg">
                                <p class="text-lg font-bold text-purple-400 mb-2">🎲 3つのフェーズ</p>
                                <p class="text-sm text-slate-400">立案→検証→構築</p>
                            </div>
                            <div class="bg-slate-900/50 p-4 rounded-lg">
                                <p class="text-lg font-bold text-blue-400 mb-2">👥 人材の雇用</p>
                                <p class="text-sm text-slate-400">市場から選んで裏返す</p>
                            </div>
                            <div class="bg-slate-900/50 p-4 rounded-lg">
                                <p class="text-lg font-bold text-green-400 mb-2">📊 フェーズ進行</p>
                                <p class="text-sm text-slate-400">配置→判定→結果</p>
                            </div>
                            <div class="bg-slate-900/50 p-4 rounded-lg">
                                <p class="text-lg font-bold text-yellow-400 mb-2">🏢 事業登録</p>
                                <p class="text-sm text-slate-400">アプリで記録</p>
                            </div>
                        </div>
                    </div>
                    <button onclick="startGame()" class="px-12 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white text-xl font-bold rounded-xl shadow-2xl hover:shadow-purple-500/50 transform hover:scale-105 transition-all">
                        ゲームを始める 🎮
                    </button>
                </div>
            `;
        }

        function calculateBusinessValue() {
            return businesses.reduce((sum, biz) => sum + (biz.profit * 12), 0);
        }

        function nextSlide() {
            currentSlideIndex++;
            renderTutorial();
        }

        function prevSlide() {
            currentSlideIndex--;
            renderTutorial();
        }

        function nextStep() {
            currentStep++;
            currentSlideIndex = 0;
            renderTutorial();
        }

        function handleEmployeeBtn() {
            const step = tutorialSteps[currentStep];
            if (step && step.type === 'action-open-employee') {
                openEmployeeModal();
                document.getElementById('close-employee-btn').disabled = true;
                document.getElementById('close-employee-btn').classList.add('opacity-50', 'cursor-not-allowed');
                nextStep();
            } else {
                openEmployeeModal();
            }
        }

        function handleBusinessBtn() {
            const step = tutorialSteps[currentStep];
            if (step && step.type === 'action-open-business') {
                openBusinessModal();
                document.getElementById('close-business-btn').disabled = true;
                document.getElementById('close-business-btn').classList.add('opacity-50', 'cursor-not-allowed');
                nextStep();
            } else {
                openBusinessModal();
            }
        }

        function handleEndTurnBtn() {
            const step = tutorialSteps[currentStep];
            if (step && step.type === 'action-end-turn') {
                endTurn();
            }
        }

        function openEmployeeModal() {
            document.getElementById('employee-modal').classList.remove('hidden');
            document.getElementById('employee-modal').classList.add('flex');
        }

        function closeEmployeeModal() {
            document.getElementById('employee-modal').classList.add('hidden');
            document.getElementById('employee-modal').classList.remove('flex');
            document.querySelectorAll('.tutorial-highlight').forEach(el => el.classList.remove('tutorial-highlight'));
            document.getElementById('close-employee-btn').disabled = false;
            document.getElementById('close-employee-btn').classList.remove('opacity-50', 'cursor-not-allowed');
        }

        function hireEmployee(type) {
            const step = tutorialSteps[currentStep];
            
            const employeeTypes = {
                junior: { name: 'ジュニア社員', cost: 100, icon: '👨‍💼', skills: '企画力:1 営業力:1' },
                senior: { name: 'シニア社員', cost: 200, icon: '👔', skills: '企画力:2 営業力:1 技術力:1' },
                expert: { name: 'エキスパート', cost: 300, icon: '🎓', skills: '企画力:2 営業力:2 技術力:1 法務力:1' }
            };
            const emp = employeeTypes[type];
            employees.push({ ...emp, id: Date.now() });
            
            updateEmployeeList();
            closeEmployeeModal();
            
            if (step && step.type === 'action-hire') {
                setTimeout(() => nextStep(), 500);
            }
        }

        function updateEmployeeList() {
            const list = document.getElementById('employee-list');
            const count = document.getElementById('employee-count');
            count.textContent = employees.length;
            
            if (employees.length === 0) {
                list.innerHTML = '<p class="text-slate-400 text-sm">まだ社員はいません</p>';
            } else {
                list.innerHTML = employees.map(emp => `
                    <div class="flex justify-between items-center p-3 bg-slate-900 rounded-lg border border-slate-700">
                        <div>
                            <div class="font-semibold">${emp.icon} ${emp.name}</div>
                            <div class="text-xs text-slate-400">${emp.skills}</div>
                        </div>
                        <div class="text-sm text-red-400">-${emp.cost}万/月</div>
                    </div>
                `).join('');
            }
        }

        function openBusinessModal() {
            document.getElementById('business-modal').classList.remove('hidden');
            document.getElementById('business-modal').classList.add('flex');
        }

        function closeBusinessModal() {
            document.getElementById('business-modal').classList.add('hidden');
            document.getElementById('business-modal').classList.remove('flex');
            document.querySelectorAll('.tutorial-highlight').forEach(el => el.classList.remove('tutorial-highlight'));
            document.getElementById('close-business-btn').disabled = false;
            document.getElementById('close-business-btn').classList.remove('opacity-50', 'cursor-not-allowed');
        }

        document.getElementById('business-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const step = tutorialSteps[currentStep];
            
            const name = document.getElementById('business-name-input').value;
            const size = document.getElementById('business-size-input').value;
            const profit = parseInt(document.getElementById('business-profit-input').value);
            const cost = parseInt(document.getElementById('business-cost-input').value);
            
            playerCash -= cost;
            
            businesses.push({ id: Date.now(), name, size, profit, cost });
            updateBusinessList();
            
            document.getElementById('business-name-input').value = '';
            document.getElementById('business-profit-input').value = '';
            document.getElementById('business-cost-input').value = '';
            
            closeBusinessModal();
            
            if (step && step.type === 'action-add-business') {
                setTimeout(() => nextStep(), 500);
            }
        });

        function updateBusinessList() {
            const list = document.getElementById('business-list');
            if (businesses.length === 0) {
                list.innerHTML = '<p class="text-slate-400 text-sm">まだ事業はありません</p>';
            } else {
                list.innerHTML = businesses.map(biz => {
                    const value = biz.profit * 12;
                    return `
                        <div class="p-4 bg-slate-900 rounded-lg border border-slate-700">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-lg">${biz.name}</h4>
                                <span class="px-2 py-1 bg-slate-800 border border-slate-600 text-slate-300 text-xs font-bold rounded">${biz.size}</span>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div class="${biz.profit >= 0 ? 'text-green-400' : 'text-red-400'}">
                                    月間利益: ${biz.profit >= 0 ? '+' : ''}${biz.profit.toLocaleString()}万
                                </div>
                                <div class="${value >= 0 ? 'text-green-400' : 'text-red-400'} font-bold">
                                    事業価値: ${value >= 0 ? '+' : ''}${value.toLocaleString()}万
                                </div>
                            </div>
                            <div class="mt-2 text-xs text-slate-500">
                                構築費用: ${biz.cost.toLocaleString()}万円
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function endTurn() {
            const monthlyIncome = 500;
            const businessIncome = businesses.reduce((sum, biz) => sum + biz.profit, 0);
            const employeeCost = employees.reduce((sum, emp) => sum + emp.cost, 0);
            const total = monthlyIncome + businessIncome - employeeCost;
            
            playerCash += total;
            currentTurn++;
            
            alert(`ターン終了！\n\n月次収入: +${monthlyIncome}万\n事業利益: +${businessIncome}万\n人件費: -${employeeCost}万\n\n月間収支: ${total >= 0 ? '+' : ''}${total}万円\n現金: ${playerCash.toLocaleString()}万円`);
            
            const step = tutorialSteps[currentStep];
            if (step && step.type === 'action-end-turn') {
                setTimeout(() => nextStep(), 1000);
            }
        }

        function startGame() {
            alert('ゲームを始めます！');
        }

        // 初期化
        renderTutorial();
    </script>
</body>
</html>